'use client';

import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { AlertTriangle, Shield, Bug, Lock, Code, ExternalLink } from 'lucide-react';
import { GlassmorphicCard } from '@/components/ui/GlassmorphicCard';

interface Vulnerability {
  id: string;
  title: string;
  severity: 'critical' | 'high' | 'medium' | 'low';
  cvss: number;
  type: string;
  discovered: Date;
  target: string;
}

export function VulnerabilityFeed() {
  const [vulnerabilities, setVulnerabilities] = useState<Vulnerability[]>([
    { id: '1', title: 'SQL Injection in Login Form', severity: 'critical', cvss: 9.8, type: 'SQLi', discovered: new Date(), target: 'example.com' },
    { id: '2', title: 'XSS in Search Parameter', severity: 'high', cvss: 7.5, type: 'XSS', discovered: new Date(), target: 'api.test.io' },
    { id: '3', title: 'Missing CSRF Token', severity: 'medium', cvss: 5.3, type: 'CSRF', discovered: new Date(), target: 'app.secure.net' },
    { id: '4', title: 'Weak SSL Configuration', severity: 'medium', cvss: 4.8, type: 'SSL', discovered: new Date(), target: 'example.com' },
    { id: '5', title: 'Directory Traversal', severity: 'high', cvss: 8.1, type: 'Path', discovered: new Date(), target: 'api.test.io' },
  ]);

  const severityConfig = {
    critical: { color: 'red', bg: 'bg-red-500/20', text: 'text-red-400', border: 'border-red-500/50' },
    high: { color: 'orange', bg: 'bg-orange-500/20', text: 'text-orange-400', border: 'border-orange-500/50' },
    medium: { color: 'yellow', bg: 'bg-yellow-500/20', text: 'text-yellow-400', border: 'border-yellow-500/50' },
    low: { color: 'blue', bg: 'bg-blue-500/20', text: 'text-blue-400', border: 'border-blue-500/50' },
  };

  const typeIcons = {
    SQLi: Code,
    XSS: Bug,
    CSRF: Shield,
    SSL: Lock,
    Path: ExternalLink,
  };

  return (
    <GlassmorphicCard className="p-6 h-[600px] flex flex-col">
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-2xl font-bold text-cyan-400 flex items-center gap-2">
          <AlertTriangle className="w-6 h-6" />
          Active Vulnerabilities
        </h2>
        <motion.div
          className="text-sm text-gray-400"
          animate={{ opacity: [0.5, 1, 0.5] }}
          transition={{ duration: 2, repeat: Infinity }}
        >
          Auto-refresh
        </motion.div>
      </div>

      <div className="flex-1 overflow-y-auto space-y-3 pr-2 custom-scrollbar">
        <AnimatePresence>
          {vulnerabilities.map((vuln, index) => {
            const config = severityConfig[vuln.severity];
            const Icon = typeIcons[vuln.type as keyof typeof typeIcons] || Bug;

            return (
              <motion.div
                key={vuln.id}
                className={`p-4 rounded-xl border ${config.border} ${config.bg} backdrop-blur-xl cursor-pointer group`}
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                exit={{ opacity: 0, x: 20 }}
                transition={{ delay: index * 0.05 }}
                whileHover={{ scale: 1.02, x: 5 }}
              >
                <div className="flex items-start gap-3">
                  <Icon className={`w-5 h-5 ${config.text} flex-shrink-0 mt-0.5`} />
                  
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <h3 className="font-semibold text-sm truncate">{vuln.title}</h3>
                    </div>
                    
                    <div className="flex items-center gap-2 text-xs text-gray-400 mb-2">
                      <span className="truncate">{vuln.target}</span>
                      <span>â€¢</span>
                      <span>{new Date(vuln.discovered).toLocaleTimeString()}</span>
                    </div>

                    <div className="flex items-center gap-2">
                      <span className={`px-2 py-0.5 rounded-full text-xs font-semibold uppercase ${config.bg} ${config.text}`}>
                        {vuln.severity}
                      </span>
                      <span className="px-2 py-0.5 rounded-full text-xs bg-white/10 text-gray-300">
                        CVSS {vuln.cvss}
                      </span>
                      <span className="px-2 py-0.5 rounded-full text-xs bg-cyan-400/20 text-cyan-400">
                        {vuln.type}
                      </span>
                    </div>
                  </div>

                  {/* Severity indicator */}
                  <div className="flex-shrink-0">
                    <motion.div
                      className={`w-8 h-8 rounded-full ${config.bg} ${config.text} flex items-center justify-center font-bold text-sm`}
                      animate={{
                        boxShadow: [
                          `0 0 10px ${config.color === 'red' ? 'rgba(255,0,85,0.3)' : 'rgba(255,184,0,0.3)'}`,
                          `0 0 20px ${config.color === 'red' ? 'rgba(255,0,85,0.6)' : 'rgba(255,184,0,0.6)'}`,
                          `0 0 10px ${config.color === 'red' ? 'rgba(255,0,85,0.3)' : 'rgba(255,184,0,0.3)'}`,
                        ],
                      }}
                      transition={{ duration: 2, repeat: Infinity }}
                    >
                      {Math.round(vuln.cvss)}
                    </motion.div>
                  </div>
                </div>

                {/* Hover glow */}
                <motion.div
                  className="absolute inset-0 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"
                  style={{
                    background: `radial-gradient(circle at center, ${config.color === 'red' ? 'rgba(255,0,85,0.1)' : 'rgba(0,255,255,0.1)'}, transparent)`,
                  }}
                />
              </motion.div>
            );
          })}
        </AnimatePresence>
      </div>
    </GlassmorphicCard>
  );
}
